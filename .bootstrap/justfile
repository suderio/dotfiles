# Lista de linguagens/pacotes desejados
LANGUAGE_PACKAGES := "luarocks rubygems npm composer jdk-openjdk python-pipenv julia cpanminus"

# Task principal
install-languages:
    @just _check-os-and-install "{{LANGUAGE_PACKAGES}}"

# PrÃ©via dos pacotes faltantes
preview-languages:
    #! /bin/bash
    for pkg in {{LANGUAGE_PACKAGES}}; do
      if ! pacman -Qi "$pkg" &>/dev/null; then
        echo "$pkg estÃ¡ ausente e serÃ¡ instalado."
      fi
    done

# Detecta o sistema operacional e chama a task de instalaÃ§Ã£o correta
_check-os-and-install pkgs:
    #! /bin/bash
    os=$(uname -s)
    if [ "$os" != "Linux" ]; then
      echo "âš ï¸ Sistema operacional '$os' ainda nÃ£o implementado."
      exit 1
    fi

    if [ -f /etc/os-release ]; then
      . /etc/os-release
      distro=$ID
    else
      echo "âš ï¸ NÃ£o foi possÃ­vel detectar a distribuiÃ§Ã£o Linux."
      exit 1
    fi

    case "$distro" in
      arch|manjaro|garuda)
        just _install-if-missing "{{pkgs}}"
        ;;
      *)
        echo "âš ï¸ DistribuiÃ§Ã£o '$distro' ainda nÃ£o implementada."
        exit 1
        ;;
    esac

# Instala pacotes ausentes, usando pacman ou AUR
_install-if-missing pkgs:
    #! /bin/bash
    missing=()
    for pkg in {{pkgs}}; do
      if ! pacman -Qi "$pkg" &>/dev/null; then
        missing+=("$pkg")
      fi
    done

    if [ "${#missing[@]}" -eq 0 ]; then
      echo "âœ… Todos os pacotes jÃ¡ estÃ£o instalados."
      exit 0
    fi

    echo "ðŸ“¦ Instalando pacotes ausentes: ${missing[*]}"
    for pkg in "${missing[@]}"; do
      echo "â†’ Verificando: $pkg"
      if pacman -Si "$pkg" &>/dev/null; then
        echo "  â†’ Instalando com pacman"
        sudo pacman -S --noconfirm --needed "$pkg"
      elif command -v paru &>/dev/null; then
        echo "  â†’ Instalando com paru (AUR)"
        paru -S --noconfirm --needed "$pkg"
      elif command -v yay &>/dev/null; then
        echo "  â†’ Instalando com yay (AUR)"
        yay -S --noconfirm --needed "$pkg"
      else
        echo "  âœ— Nenhum helper AUR (paru/yay) encontrado para instalar '$pkg'."
        exit 1
      fi
    done
